<h1 class="title">Subscription settings</h1>


  <div class="columns">

    <div class="column is-3">
      <%= simple_form_for(@subscription) do |form| %>
        <div class="field">
        <p class="control has-icons-left is-expanded">
          <%= form.input_field :plan_id,
           collection: @plans.map {|plan| ["#{plan.name} - $#{plan.cost}", plan.id]},
           wrapper_html: { class: ' select is-fullwidth' }, class: 'input', label: false, prompt: 'Select a plan' %>
          <span class="icon is-small is-left">
            <i class="fa fa-bars"></i>
          </span>
        </p>
      </div>
        <div class="field">
        <p class="control has-icons-left is-expanded">
          <%= form.input_field :duration,
           collection: Plan::RANGE.map {|m| ["#{pluralize(m, 'month')}", m]},
           wrapper_html: { class: ' select is-fullwidth' }, class: 'input', label: false, prompt: 'Add months' %>
          <span class="icon is-small is-left">
            <i class="fa fa-clock-o"></i>
          </span>
        </p>
      </div>
        <div class="field">
          <p class="control">
            <%= form.submit "Continue", class: "button is-primary is-fullwidth", id: "subscribe" %>
            <a class="button is-loading is-primary" id="loading-pay-btn">Loading</a>
          </p>
        </div>
      <% end %>
    </div>
    <div class="column is-3">
      <div class="card current-plan">
        <span id="cpl">current plan</span>
        <div class="card-content">
          <div class="media">
            <div class="media-content">
              <p class="title is-4"><%= current_user.subscription.plan.name %></p>
              <p class="subtitle is-6">$ <%= current_user.subscription.plan.cost %></p>
            </div>
          </div>

          <div class="content">
            <small>Expires: </small><br/>
            <small><%= current_user.subscription.end_date.strftime("%I:%M %p - %m %b %Y") %></small>
          </div>
        </div>
      </div>
    </div>
  </div>


<hr/>
<h1 class="title">Available plans</h1>
<div class="columns">
  <% @plans.each_slice(2) do |plans| %>
    <% plans.each do |plan| %>
      <div class="column is-3 plans">
        <div class="card plan" id="<%= plan.id %>">

          <div class="card-content">
            <div class="media">

              <div class="media-content">
                <p class="title is-4"><%= plan.name %></p>
                <p class="subtitle is-6">$ <%= plan.cost %></p>
              </div>
            </div>

            <div class="content">
              <%= plan.description %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
